<div class="container-fluid animate-fade-in">
    <div class="row mb-4">
        <div class="col-12">
            <h3 class="mb-4 animate-fade-in"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</h3>
        </div>
    </div>

    <!-- Welcome Card with Glass Morphism -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card dashboard-welcome-card animate-fade-in delay-1">
                <div class="card-header">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle me-3 overflow-hidden" style="width: 64px; height: 64px;">
                            <% if (locals.user.avatar) { %>
                            <img src="<%= locals.user.avatar %>" alt="<%= locals.user.name %>" class="w-100 h-100" style="object-fit: cover;">
                            <% } else { %>
                            <div class="bg-primary w-100 h-100 d-flex align-items-center justify-content-center text-white">
                                <i class="fas fa-user-circle fa-2x"></i>
                            </div>
                            <% } %>
                        </div>
                        <div>
                            <h4 class="mb-0" style="font-size:18px;">Welcome back, <%= locals.user.name %>!</h4>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-12 text-center">
                            <p class="mb-3 d-none d-lg-block">Welcome to your dashboard! Here you can see your stats and access quick actions</p>
                            <a href="/profile" class="btn btn-primary">
                                <i class="fas fa-user-circle me-2"></i>View Your Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
            <div class="card h-100 animate-fade-in delay-2">
                <div class="card-body text-center">
                    <div class="rounded-circle bg-primary bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                        <i class="fas fa-trophy fa-2x text-primary"></i>
                    </div>
                    <h3 class="stat-counter"><%= locals.user.challengePoints || 0 %></h3>
                    <p class="stat-label mb-0">Challenge Points</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
            <div class="card h-100 animate-fade-in delay-3">
                <div class="card-body text-center">
                    <div class="rounded-circle bg-success bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                        <i class="fas fa-users fa-2x text-success"></i>
                    </div>
                    <h3 class="stat-counter">0</h3>
                    <p class="stat-label mb-0">Team Members</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-4 mb-md-0">
            <div class="card h-100 animate-fade-in delay-3">
                <div class="card-body text-center">
                    <div class="rounded-circle bg-info bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                        <i class="fas fa-wallet fa-2x text-info"></i>
                    </div>
                    <h3 class="stat-counter">$<%= locals.user.balance ? Number(locals.user.balance).toFixed(2) : '0.00' %></h3>
                    <p class="stat-label mb-0">Balance</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6">
            <div class="card h-100 animate-fade-in delay-4">
                <div class="card-body text-center">
                    <div class="rounded-circle bg-warning bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                        <i class="fas fa-tasks fa-2x text-warning"></i>
                    </div>
                    <h3 class="stat-counter"><%= locals.user.completedChallenges ? locals.user.completedChallenges.length : 0 %></h3>
                    <p class="stat-label mb-0">Completed Tasks</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Rewards Card -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card animate-fade-in delay-4" id="daily-reward-card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-gift me-2"></i>Daily Rewards</h5>
                </div>
                <div class="card-body">
                    <div class="text-center" id="reward-status-loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Checking reward status...</p>
                    </div>
                    
                    <!-- This will be shown if user is not eligible for any VIP level -->
                    <div class="text-center d-none" id="no-vip-status">
                        <div class="rounded-circle bg-secondary bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                            <i class="fas fa-lock fa-2x text-secondary"></i>
                        </div>
                        <h4>Not Eligible</h4>
                        <p>You need at least $80 balance to qualify for daily rewards.</p>
                    </div>
                    
                    <!-- This will be shown if user is eligible but needs to wait -->
                    <div class="text-center d-none" id="waiting-for-cooldown">
                        <div class="rounded-circle bg-warning bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                            <i class="fas fa-hourglass-half fa-2x text-warning"></i>
                        </div>
                        <h4>Not Ready Yet</h4>
                        <p id="cooldown-message">You can claim your next reward in <span id="cooldown-timer">60</span> seconds.</p>
                    </div>
                    
                    <!-- This will be shown if user can claim their reward -->
                    <div class="text-center d-none" id="can-claim-reward">
                        <div class="rounded-circle bg-success bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                            <i class="fas fa-gift fa-2x text-success"></i>
                        </div>
                        <h4>Reward Ready!</h4>
                        <p>You can claim your VIP <span id="vip-level-display">1</span> reward of $<span id="reward-amount-display">0.00</span></p>
                        <button id="claim-reward-btn" class="btn btn-success">
                            <i class="fas fa-gift me-2"></i>Claim Reward
                        </button>
                    </div>
                    
                    <!-- This will be shown after successful claim -->
                    <div class="text-center d-none" id="claim-success">
                        <div class="rounded-circle bg-success bg-opacity-10 p-3 mx-auto mb-3" style="width: fit-content;">
                            <i class="fas fa-check-circle fa-2x text-success"></i>
                        </div>
                        <h4>Reward Claimed!</h4>
                        <p id="success-message">You've claimed $<span id="claimed-amount">0.00</span>. New balance: $<span id="new-balance">0.00</span></p>
                    </div>
                    
                    <!-- Error message area -->
                    <div class="alert alert-danger mt-3 d-none" id="reward-error">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <span id="error-message">An error occurred.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="card animate-fade-in delay-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex flex-wrap justify-content-center gap-3">
                        <a href="/team" class="btn btn-primary">
                            <i class="fas fa-users me-2"></i>View Team
                        </a>
                        <a href="/investments" class="btn btn-success">
                            <i class="fas fa-chart-line me-2"></i>Investments
                        </a>
                        <a href="/challenges" class="btn btn-warning">
                            <i class="fas fa-trophy me-2"></i>Daily Challenges
                        </a>
                        <button type="button" class="btn btn-info" id="contactSupportBtn">
                            <i class="fas fa-headset me-2"></i>Contact Support
                        </button>
                        <% if (locals.user && locals.user.role === 'admin') { %>
                        <a href="/admin" class="btn btn-danger">
                            <i class="fas fa-user-shield me-2"></i>Admin Panel
                        </a>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Contact Support Panel (Hidden by default) -->
<div id="contactSupportSection">
<div id="contactSupportPanel" class="contact-support-panel" style="display: none;">
    <div class="contact-support-container">
        <div class="contact-support-header">
            <div class="support-header-icon">
                <i class="fas fa-headset"></i>
            </div>
            <h4>Contact Support</h4>
            <button type="button" class="contact-close-btn" id="closeSupportPanel" aria-label="Close support panel">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="contact-support-body">
            <div class="support-intro mb-4">
                <p>Our support team is here to help you with any questions or issues you may have. Please fill out the form below and we'll get back to you as soon as possible.</p>
                <div class="support-note">
                    <i class="fas fa-info-circle me-2"></i>
                    <span>You can submit one support ticket per day.</span>
                </div>
            </div>
            <form id="contactSupportForm" action="/contact-support" method="post">
                <div class="mb-4">
                    <label for="supportSubject" class="form-label">Subject</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-tag"></i></span>
                        <input type="text" class="form-control" id="supportSubject" name="subject" required placeholder="How can we help you?">
                    </div>
                </div>
                <div class="mb-4">
                    <label for="supportMessage" class="form-label">Message</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-comment-alt"></i></span>
                        <textarea class="form-control" id="supportMessage" name="message" rows="5" required placeholder="Please describe your issue in detail..."></textarea>
                    </div>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary support-submit-btn">
                        <i class="fas fa-paper-plane me-2"></i>Submit Request
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Contact Support Styles -->
<style>
    .contact-support-panel {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(13, 17, 23, 0.85);
        backdrop-filter: blur(5px);
        z-index: 9999;
        display: flex;
        justify-content: center;
        align-items: center;
        animation: fadeIn 0.3s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .contact-support-container {
        width: 550px;
        max-width: 90%;
        background: #1a1f2b;
        border-radius: 16px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transform: translateY(0);
        animation: slideUp 0.4s ease-out;
    }
    
    @keyframes slideUp {
        from { transform: translateY(30px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    
    .contact-support-header {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        padding: 20px 25px;
        background: linear-gradient(135deg, #4b6cb7, #182848);
        color: white;
        position: relative;
    }
    
    .support-header-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 22px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .contact-support-header h4 {
        margin: 0;
        font-weight: 600;
        font-size: 20px;
        letter-spacing: 0.5px;
    }
    
    .contact-close-btn {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
    }
    
    .contact-close-btn:hover {
        background-color: rgba(255, 255, 255, 0.25);
        transform: translateY(-50%) scale(1.1);
    }
    
    .contact-support-body {
        padding: 25px;
        color: #e1e1e1;
    }
    
    .support-intro p {
        color: #b8b9bd;
        line-height: 1.6;
        margin-bottom: 15px;
    }
    
    .support-note {
        background: rgba(75, 108, 183, 0.15);
        border-left: 3px solid #4b6cb7;
        padding: 12px 15px;
        border-radius: 0 8px 8px 0;
        display: flex;
        align-items: center;
        font-size: 14px;
    }
    
    .support-note i {
        color: #4b6cb7;
    }
    
    #contactSupportForm .form-label {
        color: #000000;
        font-weight: 500;
        margin-bottom: 8px;
        font-size: 15px;
    }
    
    #contactSupportForm .input-group-text {
        background-color: rgba(75, 108, 183, 0.2);
        border: 1px solid rgba(75, 108, 183, 0.3);
        color: #4b6cb7;
    }
    
    #contactSupportForm .form-control {
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: white;
        padding: 12px 15px;
        font-size: 15px;
        transition: all 0.3s;
    }
    
    #contactSupportForm .form-control::placeholder {
        color: rgba(255, 255, 255, 0.3);
    }
    
    #contactSupportForm .form-control:focus {
        background-color: rgba(255, 255, 255, 0.1);
        border-color: #4b6cb7;
        box-shadow: 0 0 0 0.25rem rgba(75, 108, 183, 0.25);
    }
    
    .support-submit-btn {
        background: linear-gradient(135deg, #4b6cb7, #182848);
        border: none;
        padding: 12px;
        font-weight: 600;
        letter-spacing: 0.5px;
        transition: all 0.3s;
    }
    
    .support-submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(75, 108, 183, 0.4);
        background: linear-gradient(135deg, #5d7ec9, #243b6a);
    }
</style>

<!-- Contact Support Script -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const contactBtn = document.getElementById('contactSupportBtn');
        const contactPanel = document.getElementById('contactSupportPanel');
        const closeBtn = document.getElementById('closeSupportPanel');
        const contactForm = document.getElementById('contactSupportForm');
        
        // Show contact panel when button is clicked
        contactBtn.addEventListener('click', function() {
            contactPanel.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling
        });
        
        // Hide contact panel when close button is clicked
        closeBtn.addEventListener('click', function() {
            contactPanel.style.display = 'none';
            document.body.style.overflow = 'auto'; // Enable scrolling
        });
        
        // Close panel when clicking outside the form
        contactPanel.addEventListener('click', function(e) {
            if (e.target === contactPanel) {
                contactPanel.style.display = 'none';
                document.body.style.overflow = 'auto'; // Enable scrolling
            }
        });
        
        // Handle escape key to close panel
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && contactPanel.style.display === 'flex') {
                contactPanel.style.display = 'none';
                document.body.style.overflow = 'auto'; // Enable scrolling
            }
        });
        
        // Form submission
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            console.log('Contact support form submitted');
            
            // Get form data
            const subject = document.getElementById('supportSubject').value;
            const message = document.getElementById('supportMessage').value;
            
            console.log('Form data:', { subject, message });
            
            // Get CSRF token from meta tag
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
            console.log('CSRF token found:', !!csrfToken);
            
            // Prepare request data
            const requestData = {
                subject: subject,
                message: message
            };
            
            console.log('Sending request to /contact-support with data:', requestData);
            
            // Submit the form using fetch API
            fetch('/contact-support', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'CSRF-Token': csrfToken
                },
                body: JSON.stringify(requestData)
            })
            .then(response => {
                console.log('Response received:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                
                if (data.success) {
                    console.log('Support request submitted successfully');
                    // Show success message
                    new Noty({
                        theme: 'nest',
                        text: 'Your message has been sent. We will get back to you soon.',
                        type: 'success',
                        layout: 'topRight',
                        timeout: 3000
                    }).show();
                    
                    // Reset form and close panel
                    contactForm.reset();
                    contactPanel.style.display = 'none';
                    document.body.style.overflow = 'auto'; // Enable scrolling
                } else {
                    console.error('Support request failed:', data.message);
                    // Show error message
                    new Noty({
                        theme: 'nest',
                        text: data.message || 'Failed to send message. Please try again.',
                        type: 'error',
                        layout: 'topRight',
                        timeout: 3000
                    }).show();
                }
            })
            .catch(error => {
                console.error('Error sending support message:', error);
                // Show error message
                new Noty({
                    theme: 'nest',
                    text: 'An error occurred. Please try again later.',
                    type: 'error',
                    layout: 'topRight',
                    timeout: 3000
                }).show();
            });
        });
    });
</script>
</div> <!-- End of contactSupportSection -->

<!-- Quick actions and account settings sections removed -->

<!-- Load the daily rewards script -->
<script src="/js/daily-rewards.js"></script>
